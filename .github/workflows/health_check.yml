name: Health Check

on:
  workflow_dispatch:  # 수동 실행 전용

jobs:
  health-check:
    runs-on: ubuntu-latest
    
    # 타임존 설정 (로그 시간용)
    env:
      TZ: 'Asia/Seoul'
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Set up Just
      uses: extractions/setup-just@v2



    - name: Create Secrets
      run: |
        mkdir -p secrets
        echo '${{ secrets.GOOGLE_SERVICE_ACCOUNT_JSON }}' > secrets/service_account.json
        chmod -R 777 secrets

    - name: Create .env file
      run: |
        echo "GOOGLE_DRIVE_FOLDER_ID=${{ secrets.DRIVE_FOLDER_ID }}" > .env
        echo "LOG_LEVEL=INFO" >> .env

    - name: Build Docker Image
      run: just -f Justfile.linux build

    - name: Run Auth Check
      run: just -f Justfile.linux docker-auth

    - name: Run Healthcheck
      run: |
        just -f Justfile.linux docker-healthcheck
